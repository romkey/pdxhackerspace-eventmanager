<% if @site_config.banner_image.attached? %>
  <div class="mb-4">
    <%= image_tag @site_config.banner_image, class: "img-fluid rounded w-100", alt: "#{@site_config.organization_name} Banner", style: "max-height: 400px; object-fit: cover;" %>
  </div>
<% end %>

<div class="jumbotron bg-light p-5 rounded">
  <h1 class="display-4">Welcome to EventManager</h1>
  <p class="lead">Manage and discover events at our hackerspace</p>
  <hr class="my-4">
  <p>Browse upcoming events, create your own, and stay connected with the community.</p>
  <%= link_to "View All Events", events_path, class: "btn btn-primary btn-lg" %>
  <% if !user_signed_in? %>
    <% if authentik_configured? %>
      <%= button_to "Sign In with Authentik", user_authentik_omniauth_authorize_path, method: :post, class: "btn btn-secondary btn-lg", data: { turbo: false } %>
    <% end %>
    <%= link_to "Sign Up", new_user_registration_path, class: "btn btn-outline-primary btn-lg" %>
  <% else %>
    <%= link_to "Create New Event", new_event_path, class: "btn btn-success btn-lg" %>
  <% end %>
</div>

<div class="mt-5">
  <h2>Upcoming Events</h2>
  <% if @upcoming_events.any? %>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <% @upcoming_events.each do |event| %>
        <div class="col">
          <div class="card h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">
                  <%= link_to event.title, event_path(event), class: "text-decoration-none text-body" %>
                </h5>
                <span class="badge bg-<%= event.public? ? 'success' : (event.members_only? ? 'info' : 'warning') %>">
                  <i class="bi bi-<%= event.public? ? 'globe' : (event.members_only? ? 'people' : 'lock') %>"></i>
                </span>
              </div>
              <p class="card-text"><%= truncate(event.description, length: 100) %></p>
              <p class="text-muted mb-2">
                <small><i class="bi bi-calendar"></i> <%= event.start_time.strftime('%B %d, %Y at %I:%M %p') %></small><br>
                <small><i class="bi bi-clock"></i> <%= event.duration %> minutes</small><br>
                <% 
                  open_to_text = case event.open_to
                  when 'public' then 'Open to everyone'
                  when 'members' then 'Members only'
                  when 'private' then 'By invitation'
                  end
                %>
                <small><i class="bi bi-<%= event.open_to == 'public' ? 'door-open' : (event.open_to == 'members' ? 'people-fill' : 'envelope') %>"></i> <%= open_to_text %></small>
              </p>
            </div>
            <div class="card-footer">
              <%= link_to "View Details", event_path(event), class: "btn btn-sm btn-primary" %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-muted">No upcoming events scheduled.</p>
  <% end %>
</div>
